
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Creating the tables in the database following the 3NF form &#8212; My Jupyter Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'EAS503_python_project_(3)';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to your Jupyter Book" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">My Jupyter Book</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Creating the tables in the database following the 3NF form</a></li>




</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/yaseensiddiqui36/equipment_maintanenance_prediction_app" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/yaseensiddiqui36/equipment_maintanenance_prediction_app/issues/new?title=Issue%20on%20page%20%2FEAS503_python_project_(3).html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/EAS503_python_project_(3).ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Creating the tables in the database following the 3NF form</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Creating the tables in the database following the 3NF form</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-create-3-tables">We will create 3 tables:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#newly-created-normalized-database-in-3nf-form-with-tables-location-equipment-measurements">Newly created Normalized Database in 3NF form with tables Location, Equipment, Measurements</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Newly created Normalized Database in 3NF form with tables Location, Equipment, Measurements</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hence-from-the-scree-plot-the-elbow-is-forming-at-12-hence-first-12-features-explain-the-95-of-the-variance-and-it-gives-the-accuracy-of-98-5-with-random-forest-classifier">Hence from the scree plot the elbow is forming at 12, hence first 12 features explain the 95% of the variance and it gives the accuracy of 98.5% with Random Forest Classifier</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-experiment">Custom Experiment</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install -q dagshub mlflow
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dagshub</span>
<span class="n">dagshub</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_owner</span><span class="o">=</span><span class="s1">&#39;yaseensiddiqui36&#39;</span><span class="p">,</span> <span class="n">repo_name</span><span class="o">=</span><span class="s1">&#39;my-first-repo&#39;</span><span class="p">,</span> <span class="n">mlflow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Accessing as yaseensiddiqui36
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Initialized MLflow to track repo <span style="color: #008000; text-decoration-color: #008000">"yaseensiddiqui36/my-first-repo"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Repository yaseensiddiqui36/my-first-repo initialized!
</pre>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">sqlite3</span> <span class="kn">import</span> <span class="n">Error</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Yaseen\anaconda3\Lib\site-packages\pandas\core\arrays\masked.py:60: UserWarning: Pandas requires version &#39;1.3.6&#39; or newer of &#39;bottleneck&#39; (version &#39;1.3.5&#39; currently installed).
  from pandas.core import (
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_connection</span><span class="p">(</span><span class="n">db_file</span><span class="p">,</span> <span class="n">delete_db</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="k">if</span> <span class="n">delete_db</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">db_file</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">db_file</span><span class="p">)</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_file</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys = 1&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">create_table_sql</span><span class="p">,</span> <span class="n">drop_table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">drop_table_name</span><span class="p">:</span> <span class="c1"># You can optionally pass drop_table_name to drop the table. </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">drop_table_name</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_table_sql</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">execute_sql_statement</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">)</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">rows</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db_name</span> <span class="o">=</span> <span class="s1">&#39;equipment_anamoly_data.db&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sqlite3.Connection at 0x22573469990&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;equipment_anomaly_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;equipment_anomaly_data.csv&#39;</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:1026,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1014</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1015</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:620,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">620</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:1620,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1619</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1620</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:1880,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1878</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1879</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1880</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1881</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1882</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1883</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1884</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1885</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1886</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1887</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1888</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1889</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1890</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1891</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\common.py:873,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">873</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">874</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">878</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">881</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;equipment_anomaly_data.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
      <th>equipment</th>
      <th>location</th>
      <th>faulty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>58.180180</td>
      <td>25.029278</td>
      <td>0.606516</td>
      <td>45.694907</td>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>75.740712</td>
      <td>22.954018</td>
      <td>2.338095</td>
      <td>41.867407</td>
      <td>Compressor</td>
      <td>Chicago</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>71.358594</td>
      <td>27.276830</td>
      <td>1.389198</td>
      <td>58.954409</td>
      <td>Turbine</td>
      <td>San Francisco</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>71.616985</td>
      <td>32.242921</td>
      <td>1.770690</td>
      <td>40.565138</td>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>66.506832</td>
      <td>45.197471</td>
      <td>0.345398</td>
      <td>43.253795</td>
      <td>Pump</td>
      <td>New York</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7667</th>
      <td>65.711521</td>
      <td>37.505934</td>
      <td>2.030521</td>
      <td>49.331471</td>
      <td>Pump</td>
      <td>New York</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7668</th>
      <td>63.005855</td>
      <td>45.164234</td>
      <td>1.264585</td>
      <td>61.905390</td>
      <td>Pump</td>
      <td>New York</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7669</th>
      <td>72.029230</td>
      <td>34.757896</td>
      <td>1.709046</td>
      <td>49.972917</td>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7670</th>
      <td>107.086485</td>
      <td>23.754114</td>
      <td>1.142522</td>
      <td>23.967977</td>
      <td>Compressor</td>
      <td>Atlanta</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7671</th>
      <td>28.468054</td>
      <td>66.588978</td>
      <td>4.677368</td>
      <td>79.670225</td>
      <td>Turbine</td>
      <td>Chicago</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>7672 rows × 7 columns</p>
</div></div></div>
</div>
<section id="creating-the-tables-in-the-database-following-the-3nf-form">
<h1>Creating the tables in the database following the 3NF form<a class="headerlink" href="#creating-the-tables-in-the-database-following-the-3nf-form" title="Link to this heading">#</a></h1>
<section id="we-will-create-3-tables">
<h2>We will create 3 tables:<a class="headerlink" href="#we-will-create-3-tables" title="Link to this heading">#</a></h2>
</section>
</section>
<section id="newly-created-normalized-database-in-3nf-form-with-tables-location-equipment-measurements">
<h1>Newly created Normalized Database in 3NF form with tables Location, Equipment, Measurements<a class="headerlink" href="#newly-created-normalized-database-in-3nf-form-with-tables-location-equipment-measurements" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="c1"># Database file name</span>
<span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;equipment_anamoly_data.db&quot;</span>

<span class="c1"># Connect to the database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Drop tables if they exist</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP TABLE IF EXISTS Measurements&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP TABLE IF EXISTS Equipment&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP TABLE IF EXISTS Location&quot;</span><span class="p">)</span>

<span class="c1"># Create Location table</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE Location (</span>
<span class="s2">    location_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    location_name TEXT UNIQUE</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Create Equipment table</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE Equipment (</span>
<span class="s2">    equipment_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    equipment_name TEXT UNIQUE</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Create Measurements table</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE Measurements (</span>
<span class="s2">    measurement_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    equipment_id INTEGER,</span>
<span class="s2">    location_id INTEGER,</span>
<span class="s2">    temperature REAL,</span>
<span class="s2">    pressure REAL,</span>
<span class="s2">    vibration REAL,</span>
<span class="s2">    humidity REAL,</span>
<span class="s2">    faulty INTEGER,</span>
<span class="s2">    FOREIGN KEY (equipment_id) REFERENCES Equipment(equipment_id),</span>
<span class="s2">    FOREIGN KEY (location_id) REFERENCES Location(location_id)</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Commit changes</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database and tables recreated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Database and tables recreated.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read unique locations and equipment from the CSV file</span>
<span class="n">location_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">equipment_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;equipment_anomaly_data.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="n">location_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">])</span>
        <span class="n">equipment_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;equipment&quot;</span><span class="p">])</span>

<span class="c1"># Convert sets to sorted lists for consistency</span>
<span class="n">unique_locations</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">location_set</span><span class="p">)</span>
<span class="n">unique_equipments</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">equipment_set</span><span class="p">)</span>

<span class="c1"># Populate Location table</span>
<span class="n">location_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">unique_locations</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO Location (location_name) VALUES (?)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">location</span><span class="p">,))</span>
    <span class="n">location_dict</span><span class="p">[</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>

<span class="c1"># Populate Equipment table</span>
<span class="n">equipment_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">equipment</span> <span class="ow">in</span> <span class="n">unique_equipments</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO Equipment (equipment_name) VALUES (?)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">equipment</span><span class="p">,))</span>
    <span class="n">equipment_dict</span><span class="p">[</span><span class="n">equipment</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>

<span class="c1"># Commit changes</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Location and Equipment tables populated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Location and Equipment tables populated.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read data from the CSV file and populate the Measurements table</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;equipment_anomaly_data.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="n">equipment_id</span> <span class="o">=</span> <span class="n">equipment_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;equipment&quot;</span><span class="p">]]</span>
        <span class="n">location_id</span> <span class="o">=</span> <span class="n">location_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]]</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">])</span>
        <span class="n">vibration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;vibration&quot;</span><span class="p">])</span>
        <span class="n">humidity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;humidity&quot;</span><span class="p">])</span>
        <span class="n">faulty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;faulty&quot;</span><span class="p">]))</span>  <span class="c1"># Convert faulty to integer</span>
        
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        INSERT INTO Measurements (equipment_id, location_id, temperature, pressure, vibration, humidity, faulty)</span>
<span class="s2">        VALUES (?, ?, ?, ?, ?, ?, ?)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">equipment_id</span><span class="p">,</span> <span class="n">location_id</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">vibration</span><span class="p">,</span> <span class="n">humidity</span><span class="p">,</span> <span class="n">faulty</span><span class="p">))</span>

<span class="c1"># Commit changes and close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Measurements table populated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Measurements table populated.
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h2>Newly created Normalized Database in 3NF form with tables Location, Equipment, Measurements<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Reconnect to the database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>

<span class="c1"># Display table contents</span>
<span class="k">def</span> <span class="nf">display_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contents of table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

<span class="c1"># Show contents of each table</span>
<span class="n">display_table</span><span class="p">(</span><span class="s2">&quot;Location&quot;</span><span class="p">)</span>
<span class="n">display_table</span><span class="p">(</span><span class="s2">&quot;Equipment&quot;</span><span class="p">)</span>
<span class="n">display_table</span><span class="p">(</span><span class="s2">&quot;Measurements&quot;</span><span class="p">)</span>

<span class="c1"># Close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contents of table Location:
   location_id  location_name
0            1        Atlanta
1            2        Chicago
2            3        Houston
3            4       New York
4            5  San Francisco

Contents of table Equipment:
   equipment_id equipment_name
0             1     Compressor
1             2           Pump
2             3        Turbine

Contents of table Measurements:
      measurement_id  equipment_id  location_id  temperature   pressure  \
0                  1             3            1    58.180180  25.029278   
1                  2             1            2    75.740712  22.954018   
2                  3             3            5    71.358594  27.276830   
3                  4             2            1    71.616985  32.242921   
4                  5             2            4    66.506832  45.197471   
...              ...           ...          ...          ...        ...   
7667            7668             2            4    65.711521  37.505934   
7668            7669             2            4    63.005855  45.164234   
7669            7670             2            1    72.029230  34.757896   
7670            7671             1            1   107.086485  23.754114   
7671            7672             3            2    28.468054  66.588978   

      vibration   humidity  faulty  
0      0.606516  45.694907       0  
1      2.338095  41.867407       0  
2      1.389198  58.954409       0  
3      1.770690  40.565138       0  
4      0.345398  43.253795       0  
...         ...        ...     ...  
7667   2.030521  49.331471       0  
7668   1.264585  61.905390       0  
7669   1.709046  49.972917       0  
7670   1.142522  23.967977       1  
7671   4.677368  79.670225       1  

[7672 rows x 8 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect to the database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>

<span class="c1"># SQL query to fetch normalized data</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">    Equipment.equipment_name,</span>
<span class="s2">    Location.location_name,</span>
<span class="s2">    Measurements.temperature,</span>
<span class="s2">    Measurements.pressure,</span>
<span class="s2">    Measurements.vibration,</span>
<span class="s2">    Measurements.humidity,</span>
<span class="s2">    Measurements.faulty</span>
<span class="s2">FROM </span>
<span class="s2">    Measurements</span>
<span class="s2">JOIN </span>
<span class="s2">    Equipment ON Measurements.equipment_id = Equipment.equipment_id</span>
<span class="s2">JOIN </span>
<span class="s2">    Location ON Measurements.location_id = Location.location_id;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Execute the query and load data into a pandas DataFrame</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="c1"># Display the DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

<span class="c1"># Close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     equipment_name  location_name  temperature   pressure  vibration  \
0           Turbine        Atlanta    58.180180  25.029278   0.606516   
1        Compressor        Chicago    75.740712  22.954018   2.338095   
2           Turbine  San Francisco    71.358594  27.276830   1.389198   
3              Pump        Atlanta    71.616985  32.242921   1.770690   
4              Pump       New York    66.506832  45.197471   0.345398   
...             ...            ...          ...        ...        ...   
7667           Pump       New York    65.711521  37.505934   2.030521   
7668           Pump       New York    63.005855  45.164234   1.264585   
7669           Pump        Atlanta    72.029230  34.757896   1.709046   
7670     Compressor        Atlanta   107.086485  23.754114   1.142522   
7671        Turbine        Chicago    28.468054  66.588978   4.677368   

       humidity  faulty  
0     45.694907       0  
1     41.867407       0  
2     58.954409       0  
3     40.565138       0  
4     43.253795       0  
...         ...     ...  
7667  49.331471       0  
7668  61.905390       0  
7669  49.972917       0  
7670  23.967977       1  
7671  79.670225       1  

[7672 rows x 7 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipment_name</th>
      <th>location_name</th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
      <th>faulty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>58.180180</td>
      <td>25.029278</td>
      <td>0.606516</td>
      <td>45.694907</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Compressor</td>
      <td>Chicago</td>
      <td>75.740712</td>
      <td>22.954018</td>
      <td>2.338095</td>
      <td>41.867407</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Turbine</td>
      <td>San Francisco</td>
      <td>71.358594</td>
      <td>27.276830</td>
      <td>1.389198</td>
      <td>58.954409</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>71.616985</td>
      <td>32.242921</td>
      <td>1.770690</td>
      <td>40.565138</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Pump</td>
      <td>New York</td>
      <td>66.506832</td>
      <td>45.197471</td>
      <td>0.345398</td>
      <td>43.253795</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7667</th>
      <td>Pump</td>
      <td>New York</td>
      <td>65.711521</td>
      <td>37.505934</td>
      <td>2.030521</td>
      <td>49.331471</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7668</th>
      <td>Pump</td>
      <td>New York</td>
      <td>63.005855</td>
      <td>45.164234</td>
      <td>1.264585</td>
      <td>61.905390</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7669</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>72.029230</td>
      <td>34.757896</td>
      <td>1.709046</td>
      <td>49.972917</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7670</th>
      <td>Compressor</td>
      <td>Atlanta</td>
      <td>107.086485</td>
      <td>23.754114</td>
      <td>1.142522</td>
      <td>23.967977</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7671</th>
      <td>Turbine</td>
      <td>Chicago</td>
      <td>28.468054</td>
      <td>66.588978</td>
      <td>4.677368</td>
      <td>79.670225</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>7672 rows × 7 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check distribution of the target variable</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s2">&quot;faulty&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Visualize the target distribution</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;faulty&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of the &#39;faulty&#39; Column&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>faulty
0    0.900026
1    0.099974
Name: proportion, dtype: float64
</pre></div>
</div>
<img alt="_images/00752092acace90c414e30140af1ed5ab1325b89fda8a0fb95ccde3dc8afaf62.png" src="_images/00752092acace90c414e30140af1ed5ab1325b89fda8a0fb95ccde3dc8afaf62.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;faulty&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="s2">&quot;faulty&quot;</span><span class="p">]</span>

<span class="c1"># Perform train/test split with stratification</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
<span class="p">)</span>

<span class="c1"># Verify stratification</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train set distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test set distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train set distribution:
faulty
0    0.899951
1    0.100049
Name: proportion, dtype: float64

Test set distribution:
faulty
0    0.900326
1    0.099674
Name: proportion, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s2">&quot;equipment_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Visualize distribution by equipment</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;equipment_name&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;faulty&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Faulty Distribution Across Equipment&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>equipment_name
Compressor    0.335375
Turbine       0.334333
Pump          0.330292
Name: proportion, dtype: float64
</pre></div>
</div>
<img alt="_images/2aea9b0ce167049728f445fb1ac171dd63bc17571897db84f4f923228d0b54e9.png" src="_images/2aea9b0ce167049728f445fb1ac171dd63bc17571897db84f4f923228d0b54e9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s2">&quot;location_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Visualize distribution by equipment</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;location_name&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;faulty&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Faulty Distribution Across location&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>location_name
Atlanta          0.203858
Chicago          0.202424
Houston          0.201773
New York         0.198905
San Francisco    0.193040
Name: proportion, dtype: float64
</pre></div>
</div>
<img alt="_images/6fe726bb5d9c41b9fbe74151493b6f55d520a67ec57b84a85d352373c9489b5c.png" src="_images/6fe726bb5d9c41b9fbe74151493b6f55d520a67ec57b84a85d352373c9489b5c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train set distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Test set distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train set distribution:
faulty
0    0.899951
1    0.100049
Name: proportion, dtype: float64


Test set distribution:
faulty
0    0.900326
1    0.099674
Name: proportion, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic summary statistics</span>
<span class="n">df1</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
      <th>faulty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7672.000000</td>
      <td>7672.000000</td>
      <td>7672.000000</td>
      <td>7672.000000</td>
      <td>7672.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>70.922478</td>
      <td>35.738048</td>
      <td>1.611809</td>
      <td>50.016574</td>
      <td>0.099974</td>
    </tr>
    <tr>
      <th>std</th>
      <td>16.200059</td>
      <td>10.381593</td>
      <td>0.728560</td>
      <td>11.841479</td>
      <td>0.299985</td>
    </tr>
    <tr>
      <th>min</th>
      <td>10.269385</td>
      <td>3.620798</td>
      <td>-0.428188</td>
      <td>10.215077</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>62.777057</td>
      <td>29.485682</td>
      <td>1.170906</td>
      <td>42.612817</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>70.156900</td>
      <td>35.227544</td>
      <td>1.533113</td>
      <td>50.024744</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>77.568387</td>
      <td>41.159913</td>
      <td>1.924700</td>
      <td>57.340513</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>149.690420</td>
      <td>79.887734</td>
      <td>4.990537</td>
      <td>89.984718</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data types of the columns</span>
<span class="n">df1</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>equipment_name     object
location_name      object
temperature       float64
pressure          float64
vibration         float64
humidity          float64
faulty              int64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Checking for missing values</span>
<span class="n">df1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>equipment_name    0
location_name     0
temperature       0
pressure          0
vibration         0
humidity          0
faulty            0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Checking the unique values in categorical columns</span>
<span class="n">df1</span><span class="p">[</span><span class="s2">&quot;equipment_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>equipment_name
Compressor    2573
Turbine       2565
Pump          2534
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="p">[</span><span class="s2">&quot;location_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>location_name
Atlanta          1564
Chicago          1553
Houston          1548
New York         1526
San Francisco    1481
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Example: Plotting a correlation matrix heatmap</span>
<span class="c1"># correlation_matrix = df.corr()</span>

<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[[</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span><span class="s1">&#39;vibration&#39;</span><span class="p">,</span><span class="s1">&#39;humidity&#39;</span><span class="p">,</span><span class="s1">&#39;faulty&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Plot the heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1b7e0f4d2e68b24aeb003be99d0126f3fd11b9bd176331d486e12ce06d1008f7.png" src="_images/1b7e0f4d2e68b24aeb003be99d0126f3fd11b9bd176331d486e12ce06d1008f7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numerical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;vibration&quot;</span><span class="p">,</span> <span class="s2">&quot;humidity&quot;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Loop through each numerical column and plot it on a subplot</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numerical_cols</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df1</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># Plot on the ith subplot</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vertical Boxplot for </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3a7126e3a1d25028803633e75311ac8a05b41b8ef4537ed4f3556b92113d4b4b.png" src="_images/3a7126e3a1d25028803633e75311ac8a05b41b8ef4537ed4f3556b92113d4b4b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a figure with 2 rows and 2 columns</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Flatten the axes array for easy iteration</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Loop through each numerical column and create distribution plots with &#39;hue&#39; for &#39;faulty&#39;</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numerical_cols</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;faulty&quot;</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set1&quot;</span><span class="p">)</span>  <span class="c1"># kde=True adds Kernel Density Estimation</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distribution Plot for </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> with Faulty vs Non-Faulty&quot;</span><span class="p">)</span>
    
<span class="c1"># Adjust layout for better spacing</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1075: FutureWarning: When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
  data_subset = grouped_data.get_group(pd_key)
</pre></div>
</div>
<img alt="_images/36479a7ec40f50543ef318983acb9aaf0453960e254e3fac91060909196f3b17.png" src="_images/36479a7ec40f50543ef318983acb9aaf0453960e254e3fac91060909196f3b17.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipment_name</th>
      <th>location_name</th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
      <th>faulty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>58.180180</td>
      <td>25.029278</td>
      <td>0.606516</td>
      <td>45.694907</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Compressor</td>
      <td>Chicago</td>
      <td>75.740712</td>
      <td>22.954018</td>
      <td>2.338095</td>
      <td>41.867407</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Turbine</td>
      <td>San Francisco</td>
      <td>71.358594</td>
      <td>27.276830</td>
      <td>1.389198</td>
      <td>58.954409</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>71.616985</td>
      <td>32.242921</td>
      <td>1.770690</td>
      <td>40.565138</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Pump</td>
      <td>New York</td>
      <td>66.506832</td>
      <td>45.197471</td>
      <td>0.345398</td>
      <td>43.253795</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a pair plot of all the features in the dataframe</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df1</span><span class="p">[[</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;vibration&#39;</span><span class="p">,</span> <span class="s1">&#39;humidity&#39;</span><span class="p">]])</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
C:\Users\Yaseen\anaconda3\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="_images/7c3103c3fa7fb69b0584431d4284a55dea7a45b7956f8869c8c2ba67e8d0195c.png" src="_images/7c3103c3fa7fb69b0584431d4284a55dea7a45b7956f8869c8c2ba67e8d0195c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;faulty&#39;</span><span class="p">)</span>

<span class="c1"># Set the plot title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Temperature vs Pressure&quot;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a98521c70f6182cee53123a9849b0c781b2d7c8d06a284c6dd72315f2fdbe090.png" src="_images/a98521c70f6182cee53123a9849b0c781b2d7c8d06a284c6dd72315f2fdbe090.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;humidity&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;faulty&#39;</span><span class="p">)</span>

<span class="c1"># Set the plot title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Temperature vs Humidity&quot;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8e76810abe347f9e0ac6c5f4a20bf9720c25d46e4fb08080f5cd021d378e35bf.png" src="_images/8e76810abe347f9e0ac6c5f4a20bf9720c25d46e4fb08080f5cd021d378e35bf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;vibration&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;faulty&#39;</span><span class="p">)</span>

<span class="c1"># Set the plot title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Temperature vs Vibration&quot;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/473ce2f2732cb7119f00f82b5c8fbc2616ca219bd73b7e08d90c8ec491e7ac32.png" src="_images/473ce2f2732cb7119f00f82b5c8fbc2616ca219bd73b7e08d90c8ec491e7ac32.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;vibration&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;faulty&#39;</span><span class="p">)</span>

<span class="c1"># Set the plot title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Pressure vs vibration&quot;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fcc7d814e3b3fb99d9f77eefd43a3ed8b96fd28b57f0acab3992412a5263a28d.png" src="_images/fcc7d814e3b3fb99d9f77eefd43a3ed8b96fd28b57f0acab3992412a5263a28d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the box plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;humidity&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Set2&#39;</span><span class="p">)</span>

<span class="c1"># Set plot title and labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Humidity Distribution by Equipment&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Equipment_name&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Humidity&#39;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8e5bd1ce69fd96037fc27daacb0dc9d6e612f63000f49090541a0f4383fb0ea4.png" src="_images/8e5bd1ce69fd96037fc27daacb0dc9d6e612f63000f49090541a0f4383fb0ea4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the box plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Set2&#39;</span><span class="p">)</span>

<span class="c1"># Set plot title and labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Humidity Distribution by Equipment&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Equipment_name&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d4b5577b4f739afb8232a4d6118ad73eab06d32b907707892c26a0ceed51593b.png" src="_images/d4b5577b4f739afb8232a4d6118ad73eab06d32b907707892c26a0ceed51593b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the box plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;vibration&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Set2&#39;</span><span class="p">)</span>

<span class="c1"># Set plot title and labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Humidity Distribution by Equipment&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Equipment_name&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Vibration&#39;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a2b0ec21d36cd1a8b139098fe45dc0c72a8acaf1bcf9e91637213d2b0790905f.png" src="_images/a2b0ec21d36cd1a8b139098fe45dc0c72a8acaf1bcf9e91637213d2b0790905f.png" />
</div>
</div>
</section>
</section>
<section id="preprocessing">
<h1>Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;faulty&#39;</span><span class="p">])</span>  <span class="c1"># Replace with your actual target column name</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;faulty&#39;</span><span class="p">]</span>  <span class="c1"># Replace with your actual target column name</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipment_name</th>
      <th>location_name</th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
      <th>faulty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>58.180180</td>
      <td>25.029278</td>
      <td>0.606516</td>
      <td>45.694907</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Compressor</td>
      <td>Chicago</td>
      <td>75.740712</td>
      <td>22.954018</td>
      <td>2.338095</td>
      <td>41.867407</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Turbine</td>
      <td>San Francisco</td>
      <td>71.358594</td>
      <td>27.276830</td>
      <td>1.389198</td>
      <td>58.954409</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>71.616985</td>
      <td>32.242921</td>
      <td>1.770690</td>
      <td>40.565138</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Pump</td>
      <td>New York</td>
      <td>66.506832</td>
      <td>45.197471</td>
      <td>0.345398</td>
      <td>43.253795</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7667</th>
      <td>Pump</td>
      <td>New York</td>
      <td>65.711521</td>
      <td>37.505934</td>
      <td>2.030521</td>
      <td>49.331471</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7668</th>
      <td>Pump</td>
      <td>New York</td>
      <td>63.005855</td>
      <td>45.164234</td>
      <td>1.264585</td>
      <td>61.905390</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7669</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>72.029230</td>
      <td>34.757896</td>
      <td>1.709046</td>
      <td>49.972917</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7670</th>
      <td>Compressor</td>
      <td>Atlanta</td>
      <td>107.086485</td>
      <td>23.754114</td>
      <td>1.142522</td>
      <td>23.967977</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7671</th>
      <td>Turbine</td>
      <td>Chicago</td>
      <td>28.468054</td>
      <td>66.588978</td>
      <td>4.677368</td>
      <td>79.670225</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>7672 rows × 7 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipment_name</th>
      <th>location_name</th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>58.180180</td>
      <td>25.029278</td>
      <td>0.606516</td>
      <td>45.694907</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Compressor</td>
      <td>Chicago</td>
      <td>75.740712</td>
      <td>22.954018</td>
      <td>2.338095</td>
      <td>41.867407</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Turbine</td>
      <td>San Francisco</td>
      <td>71.358594</td>
      <td>27.276830</td>
      <td>1.389198</td>
      <td>58.954409</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>71.616985</td>
      <td>32.242921</td>
      <td>1.770690</td>
      <td>40.565138</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Pump</td>
      <td>New York</td>
      <td>66.506832</td>
      <td>45.197471</td>
      <td>0.345398</td>
      <td>43.253795</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7667</th>
      <td>Pump</td>
      <td>New York</td>
      <td>65.711521</td>
      <td>37.505934</td>
      <td>2.030521</td>
      <td>49.331471</td>
    </tr>
    <tr>
      <th>7668</th>
      <td>Pump</td>
      <td>New York</td>
      <td>63.005855</td>
      <td>45.164234</td>
      <td>1.264585</td>
      <td>61.905390</td>
    </tr>
    <tr>
      <th>7669</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>72.029230</td>
      <td>34.757896</td>
      <td>1.709046</td>
      <td>49.972917</td>
    </tr>
    <tr>
      <th>7670</th>
      <td>Compressor</td>
      <td>Atlanta</td>
      <td>107.086485</td>
      <td>23.754114</td>
      <td>1.142522</td>
      <td>23.967977</td>
    </tr>
    <tr>
      <th>7671</th>
      <td>Turbine</td>
      <td>Chicago</td>
      <td>28.468054</td>
      <td>66.588978</td>
      <td>4.677368</td>
      <td>79.670225</td>
    </tr>
  </tbody>
</table>
<p>7672 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       0
1       0
2       0
3       0
4       0
       ..
7667    0
7668    0
7669    0
7670    1
7671    1
Name: faulty, Length: 7672, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;vibration&#39;</span><span class="p">,</span> <span class="s1">&#39;humidity&#39;</span><span class="p">]</span>  <span class="c1"># Replace with your actual numerical features</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">,</span> <span class="s1">&#39;location_name&#39;</span><span class="p">]</span>  <span class="c1"># Replace with your actual categorical features</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the preprocessor pipeline for numerical columns</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>  <span class="c1"># Handle missing values</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Standardize the data</span>
    <span class="p">(</span><span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">())</span>  <span class="c1"># Min-Max scaling (if required, can be adjusted)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the preprocessor pipeline for categorical columns</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;missing&#39;</span><span class="p">)),</span>  <span class="c1"># Handle missing values</span>
    <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>  <span class="c1"># One-hot encode categorical features</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the complete pipeline with preprocessor and Logistic Regression</span>
<span class="n">pipeline_logistic_regression</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>  <span class="c1"># Logistic Regression model</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Stratified Train-Test Split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="logistic-regression">
<h1>Logistic Regression<a class="headerlink" href="#logistic-regression" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>


<span class="c1"># Start an MLflow run and fit the pipeline</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Fit the model</span>
    <span class="n">pipeline_logistic_regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Make predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline_logistic_regression</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Evaluate the model and log metrics</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Classification Report on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion Matrix on Test Data:
 [[1381    1]
 [  93   60]]

Classification Report on Test Data:
               precision    recall  f1-score   support

           0       0.94      1.00      0.97      1382
           1       0.98      0.39      0.56       153

    accuracy                           0.94      1535
   macro avg       0.96      0.70      0.76      1535
weighted avg       0.94      0.94      0.93      1535

🏃 View run magnificent-bass-171 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/f26deb77bd5a4ff3aad907fee9c9bfcd
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable autologging for scikit-learn</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># Split the data into train and test sets</span>
<span class="c1"># X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)</span>



<span class="c1"># Create the pipeline with preprocessing and logistic regression</span>
<span class="n">pipeline_logistic_regression</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
<span class="p">])</span>

<span class="c1"># Hyperparameter grid for Logistic Regression (for example, C and solver)</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;saga&#39;</span><span class="p">]</span>  <span class="c1"># Solver options for logistic regression</span>
<span class="p">}</span>

<span class="c1"># Perform GridSearchCV for hyperparameter tuning with 10-fold cross-validation</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_logistic_regression</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use n_jobs=1 to avoid parallel execution</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Fit the model on the entire training set with hyperparameter tuning</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Log the best hyperparameters and score</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;best_score&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

    <span class="c1"># Evaluate the model and log metrics</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Hyperparameters: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Cross-Validation Score: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Cross-validation results: mean and standard deviation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span>
    <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
    <span class="n">std_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CV Mean Score: </span><span class="si">{</span><span class="n">mean_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, CV Std Score: </span><span class="si">{</span><span class="n">std_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Evaluate the model performance on the entire training data</span>
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">))</span>

    <span class="c1"># Evaluate the model performance on the test data</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>

    <span class="c1"># Log the classification reports for training and test data</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;train_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>

    <span class="c1"># Confusion matrix for the test data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Confusion Matrix on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\linear_model\_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  warnings.warn(
2024/12/21 16:26:31 INFO mlflow.sklearn.utils: Logging the 5 best runs, 5 runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run incongruous-doe-550 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/2662af8b918b4380b8b7a33dd0dcd7ce
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run omniscient-chimp-293 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/8590b0251e5747b2b2f4d8e8a2c17bf6
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run inquisitive-gull-113 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/95c3436edccd46e0813ed1bf4bf40358
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run resilient-sow-137 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/4583d86cecae489287a6b0ae8310eb22
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run rebellious-cat-307 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/ea256470e2184efc867dee32a59a4018
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
Best Hyperparameters: {&#39;classifier__C&#39;: 10, &#39;classifier__solver&#39;: &#39;liblinear&#39;}
Best Cross-Validation Score: 0.9390584565680612
CV Mean Score: 0.9249, CV Std Score: 0.0164

Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.94      1.00      0.97      5523
           1       0.98      0.40      0.57       614

    accuracy                           0.94      6137
   macro avg       0.96      0.70      0.77      6137
weighted avg       0.94      0.94      0.93      6137


Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.94      1.00      0.97      1382
           1       0.98      0.42      0.59       153

    accuracy                           0.94      1535
   macro avg       0.96      0.71      0.78      1535
weighted avg       0.94      0.94      0.93      1535


Confusion Matrix on Test Data:
 [[1381    1]
 [  89   64]]
🏃 View run fortunate-chimp-17 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/bb6d8a3c5cbb4c16baa8c01b53e007cb
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">QuadraticDiscriminantAnalysis</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable autologging for scikit-learn</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># Define classifiers to test</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;RidgeClassifier&#39;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(),</span>
    <span class="s1">&#39;RandomForestClassifier&#39;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(),</span>
    <span class="s1">&#39;XGBClassifier&#39;</span><span class="p">:</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Hyperparameter grid for each classifier</span>
<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;RidgeClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;RandomForestClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;XGBClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;classifier__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Iterate over each classifier</span>
<span class="k">for</span> <span class="n">clf_name</span><span class="p">,</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the pipeline with preprocessing and the classifier</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span>
    <span class="p">])</span>
    
    <span class="c1"># Get the corresponding parameter grid</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span>
    
    <span class="c1"># Perform GridSearchCV for hyperparameter tuning with 10-fold cross-validation</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use n_jobs=1 to avoid parallel execution</span>
    
    <span class="c1"># Start an MLflow run</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
        <span class="c1"># Fit the model on the entire training set with hyperparameter tuning</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Log the best hyperparameters and score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;best_score&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
        
        <span class="c1"># Evaluate the model performance on the training data</span>
        <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Training Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">))</span>
        
        <span class="c1"># Log training classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_train_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
        
        <span class="c1"># Evaluate the model performance on the test data</span>
        <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Test Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>
        
        <span class="c1"># Log test classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_test_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
        
        <span class="c1"># Confusion matrix for the test data</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Confusion Matrix on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cm</span><span class="p">)</span>
        
        <span class="c1"># Log confusion matrix image</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Predicted 0&#39;</span><span class="p">,</span> <span class="s1">&#39;Predicted 1&#39;</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;True 0&#39;</span><span class="p">,</span> <span class="s1">&#39;True 1&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1"> - Confusion Matrix&#39;</span><span class="p">)</span>
        <span class="n">cm_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">_confusion_matrix.png&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">cm_filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">cm_filename</span><span class="p">)</span>
        
        <span class="c1"># Cross-validation results: mean and standard deviation</span>
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span>
        <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="n">std_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - CV Mean Score: </span><span class="si">{</span><span class="n">mean_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, CV Std Score: </span><span class="si">{</span><span class="n">std_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Log CV mean and std score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_mean_score&#39;</span><span class="p">,</span> <span class="n">mean_score</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_std_score&#39;</span><span class="p">,</span> <span class="n">std_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training RidgeClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:27:23 INFO mlflow.sklearn.utils: Logging the 5 best runs, no runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run suave-horse-581 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/924ea02496484ed286c171b015487f71
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run sedate-duck-927 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/88552df7e46245e2b4c331ae8c36db03
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run unruly-zebra-39 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/65fdf45e88f140129fac7451fb1cd80c
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

RidgeClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.93      1.00      0.96      5523
           1       1.00      0.29      0.45       614

    accuracy                           0.93      6137
   macro avg       0.96      0.64      0.70      6137
weighted avg       0.93      0.93      0.91      6137


RidgeClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.93      1.00      0.96      1382
           1       1.00      0.31      0.48       153

    accuracy                           0.93      1535
   macro avg       0.96      0.66      0.72      1535
weighted avg       0.94      0.93      0.91      1535


RidgeClassifier - Confusion Matrix on Test Data:
 [[1382    0]
 [ 105   48]]

RidgeClassifier - CV Mean Score: 0.9266, CV Std Score: 0.0021
🏃 View run brawny-snipe-472 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/aa060548889f47a48afa250b3d617f8f
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training RandomForestClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:29:11 INFO mlflow.sklearn.utils: Logging the 5 best runs, one run will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run youthful-flea-581 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/a3a239efe43e40719738b121cf65b82f
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run thundering-snipe-30 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/d27f2c742e6647e8bbfa90da387573cf
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run rare-dolphin-251 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/c25b6b6b32c2424ebe4e93ec5801dc2e
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run peaceful-fowl-115 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/adc64a33f04c4d40a5e5b97d1a5d7da1
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run polite-tern-284 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/9f6ff4b608634fdc954033fc2fc430f0
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

RandomForestClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       1.00      1.00      1.00      5523
           1       1.00      1.00      1.00       614

    accuracy                           1.00      6137
   macro avg       1.00      1.00      1.00      6137
weighted avg       1.00      1.00      1.00      6137


RandomForestClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      1.00      0.99      1382
           1       0.97      0.86      0.91       153

    accuracy                           0.98      1535
   macro avg       0.98      0.93      0.95      1535
weighted avg       0.98      0.98      0.98      1535


RandomForestClassifier - Confusion Matrix on Test Data:
 [[1378    4]
 [  21  132]]

RandomForestClassifier - CV Mean Score: 0.9805, CV Std Score: 0.0002
🏃 View run resilient-ape-415 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/aca253961c52436eab320bb1ef198427
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training XGBClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:33:07 INFO mlflow.sklearn.utils: Logging the 5 best runs, 13 runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run honorable-bee-355 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/4b803834c70c44359719f54e516267e9
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run masked-cub-65 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/232ad0a4654640cda2fffd020d445875
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run bright-snail-743 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/e5142b75998741eca13a2ebc5c79eaaf
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run selective-ray-532 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/22b48d3d84c64be2bfebc8614505377e
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run intrigued-lark-376 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/65c6d263d8524a9a8d37adf1037dd309
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

XGBClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      5523
           1       0.99      0.91      0.95       614

    accuracy                           0.99      6137
   macro avg       0.99      0.96      0.97      6137
weighted avg       0.99      0.99      0.99      6137


XGBClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      1.00      0.99      1382
           1       0.98      0.84      0.91       153

    accuracy                           0.98      1535
   macro avg       0.98      0.92      0.95      1535
weighted avg       0.98      0.98      0.98      1535


XGBClassifier - Confusion Matrix on Test Data:
 [[1379    3]
 [  24  129]]

XGBClassifier - CV Mean Score: 0.9669, CV Std Score: 0.0296
🏃 View run aged-hog-536 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/c4a4ceabe19a4a459de8e679eaf1c05e
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identify categorical columns</span>
<span class="n">categorical_cols</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Apply One-Hot Encoding</span>
<span class="n">X_train_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">categorical_cols</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_encoded</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
      <th>equipment_name_Pump</th>
      <th>equipment_name_Turbine</th>
      <th>location_name_Chicago</th>
      <th>location_name_Houston</th>
      <th>location_name_New York</th>
      <th>location_name_San Francisco</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3458</th>
      <td>68.596249</td>
      <td>29.624662</td>
      <td>0.986966</td>
      <td>58.204381</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>636</th>
      <td>71.373525</td>
      <td>24.384980</td>
      <td>1.892085</td>
      <td>37.355447</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4884</th>
      <td>74.395012</td>
      <td>36.446969</td>
      <td>1.571815</td>
      <td>67.199845</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3962</th>
      <td>71.915774</td>
      <td>28.193738</td>
      <td>1.583522</td>
      <td>46.086696</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6287</th>
      <td>53.660770</td>
      <td>24.401336</td>
      <td>2.088785</td>
      <td>30.704903</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1924</th>
      <td>70.210038</td>
      <td>43.853683</td>
      <td>1.371703</td>
      <td>51.479689</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>548</th>
      <td>61.657182</td>
      <td>37.560466</td>
      <td>1.504645</td>
      <td>62.323792</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3890</th>
      <td>55.612799</td>
      <td>32.017794</td>
      <td>1.341727</td>
      <td>61.901096</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1042</th>
      <td>79.852850</td>
      <td>65.143210</td>
      <td>1.024907</td>
      <td>71.990642</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3274</th>
      <td>56.097781</td>
      <td>36.732438</td>
      <td>1.746475</td>
      <td>42.390570</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>6137 rows × 10 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine X_train with target</span>
<span class="n">X_with_target</span> <span class="o">=</span> <span class="n">X_train_encoded</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_with_target</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_train</span>

<span class="c1"># Calculate correlations with the target variable</span>
<span class="n">correlation_with_target</span> <span class="o">=</span> <span class="n">X_with_target</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Drop the target column</span>
<span class="n">correlation_with_target</span> <span class="o">=</span> <span class="n">correlation_with_target</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>

<span class="c1"># Select features with correlation above a threshold</span>
<span class="n">selected_features_by_target</span> <span class="o">=</span> <span class="n">correlation_with_target</span><span class="p">[</span><span class="n">correlation_with_target</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">X_train_corr_with_target</span> <span class="o">=</span> <span class="n">X_train_encoded</span><span class="p">[</span><span class="n">selected_features_by_target</span><span class="p">]</span>
<span class="n">selected_features_by_target</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;vibration&#39;, &#39;pressure&#39;, &#39;temperature&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Assuming X_train_encoded and y_train are already defined</span>

<span class="c1"># Start MLFlow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature Selection Experiment #4&quot;</span><span class="p">):</span>
    
    <span class="c1">### 1. Correlation Threshold ###</span>
    <span class="k">def</span> <span class="nf">select_features_by_correlation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">target_corr_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inter_corr_threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
        <span class="c1"># Combine features with target</span>
        <span class="n">X_with_target</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">X_with_target</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        
        <span class="c1"># Correlation with target</span>
        <span class="n">correlation_with_target</span> <span class="o">=</span> <span class="n">X_with_target</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">correlation_with_target</span> <span class="o">=</span> <span class="n">correlation_with_target</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>
        
        <span class="c1"># Select features with correlation above threshold</span>
        <span class="n">selected_features_by_target</span> <span class="o">=</span> <span class="n">correlation_with_target</span><span class="p">[</span><span class="n">correlation_with_target</span> <span class="o">&gt;</span> <span class="n">target_corr_threshold</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        
        <span class="c1"># Inter-feature correlation</span>
        <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">selected_features_by_target</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="n">upper_triangle</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>
        <span class="n">to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper_triangle</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper_triangle</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">inter_corr_threshold</span><span class="p">)]</span>
        
        <span class="c1"># Drop highly correlated features</span>
        <span class="n">X_selected</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">selected_features_by_target</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X_selected</span><span class="p">,</span> <span class="n">selected_features_by_target</span><span class="p">,</span> <span class="n">to_drop</span>

    <span class="n">X_train_corr</span><span class="p">,</span> <span class="n">selected_by_corr</span><span class="p">,</span> <span class="n">dropped_corr</span> <span class="o">=</span> <span class="n">select_features_by_correlation</span><span class="p">(</span>
        <span class="n">X_train_encoded</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">target_corr_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inter_corr_threshold</span><span class="o">=</span><span class="mf">0.9</span>
    <span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Correlation Threshold with Target&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Inter-feature Correlation Threshold&quot;</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Features Retained After Correlation&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train_corr</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Features Dropped Due to Inter-Correlation&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dropped_corr</span><span class="p">))</span>

    <span class="c1">### 2. Feature Importance (Random Forest) ###</span>
    <span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_corr</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">feature_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rf_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train_corr</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">important_features</span> <span class="o">=</span> <span class="n">feature_importances</span><span class="p">[</span><span class="n">feature_importances</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">X_train_rf</span> <span class="o">=</span> <span class="n">X_train_corr</span><span class="p">[</span><span class="n">important_features</span><span class="p">]</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Feature Importance Threshold&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Features Retained After Feature Importance&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">important_features</span><span class="p">))</span>

    <span class="c1">### 3. Variance Threshold ###</span>
    <span class="n">variance_selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">X_train_final</span> <span class="o">=</span> <span class="n">variance_selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_rf</span><span class="p">)</span>
    <span class="n">final_feature_indices</span> <span class="o">=</span> <span class="n">variance_selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">final_features</span> <span class="o">=</span> <span class="n">X_train_rf</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">final_feature_indices</span><span class="p">]</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Variance Threshold&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Features Retained After Variance Threshold&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_features</span><span class="p">))</span>

    <span class="c1">### Log Final Results ###</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Final Selected Features&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">final_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Final Feature Count&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_features</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final selected features: </span><span class="si">{</span><span class="n">final_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final selected features: Index([&#39;vibration&#39;, &#39;pressure&#39;, &#39;temperature&#39;], dtype=&#39;object&#39;)
🏃 View run Feature Selection Experiment #4 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/3edbdb2941d64b518941055a49867fb7
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;vibration&#39;, &#39;pressure&#39;, &#39;temperature&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeClassifier</span><span class="p">,</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>



<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>  <span class="c1"># Handle missing values</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Standardize the data</span>
    <span class="p">(</span><span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">())</span>  <span class="c1"># Min-Max scaling (if required, can be adjusted)</span>
<span class="p">])</span>


<span class="n">preprocessor_final_features</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">final_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>



<span class="c1"># Subset training and test data to final selected features</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">final_features</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">final_features</span><span class="p">]</span>

<span class="c1"># Enable autologging for scikit-learn</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># Define classifiers to test</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s1">&#39;RidgeClassifier&#39;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s1">&#39;RandomForestClassifier&#39;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s1">&#39;XGBClassifier&#39;</span><span class="p">:</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Hyperparameter grid for each classifier</span>
<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;classifier__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;RidgeClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;RandomForestClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;XGBClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;classifier__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Iterate over each classifier</span>
<span class="k">for</span> <span class="n">clf_name</span><span class="p">,</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="c1"># Create the pipeline with preprocessing and the classifier</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor_final_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="c1"># Get the corresponding parameter grid</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span>

    <span class="c1"># Perform GridSearchCV for hyperparameter tuning with 10-fold cross-validation</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use n_jobs=1 to avoid parallel execution</span>

    <span class="c1"># Start an MLflow run</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">_FinalFeatures&quot;</span><span class="p">):</span>
        <span class="c1"># Fit the model on the entire training set with hyperparameter tuning</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># Log the best hyperparameters and score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;best_score&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

        <span class="c1"># Evaluate the model performance on the training data</span>
        <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Training Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">))</span>

        <span class="c1"># Log training classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_train_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>

        <span class="c1"># Evaluate the model performance on the test data</span>
        <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Test Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>

        <span class="c1"># Log test classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_test_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>

        <span class="c1"># Confusion matrix for the test data</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Confusion Matrix on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cm</span><span class="p">)</span>

        <span class="c1"># Log confusion matrix image</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Predicted 0&#39;</span><span class="p">,</span> <span class="s1">&#39;Predicted 1&#39;</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;True 0&#39;</span><span class="p">,</span> <span class="s1">&#39;True 1&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1"> - Confusion Matrix&#39;</span><span class="p">)</span>
        <span class="n">cm_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">_confusion_matrix.png&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">cm_filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">cm_filename</span><span class="p">)</span>

        <span class="c1"># Cross-validation results: mean and standard deviation</span>
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span>
        <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="n">std_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - CV Mean Score: </span><span class="si">{</span><span class="n">mean_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, CV Std Score: </span><span class="si">{</span><span class="n">std_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Log CV mean and std score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_mean_score&#39;</span><span class="p">,</span> <span class="n">mean_score</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_std_score&#39;</span><span class="p">,</span> <span class="n">std_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training LogisticRegression...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:34:26 INFO mlflow.sklearn.utils: Logging the 5 best runs, no runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run welcoming-sheep-342 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/d2111801c27244efa02ffad3b3232e26
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run marvelous-bear-94 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/e557ba899d8a4015b41154928b5f5876
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run thundering-fly-216 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/c88c37b59d14425dbc8af2c844da59f3
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run abrasive-ant-669 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/c8ced1accade4cf3bba994ffa4cec70e
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

LogisticRegression - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.94      1.00      0.97      5523
           1       0.99      0.39      0.56       614

    accuracy                           0.94      6137
   macro avg       0.96      0.69      0.76      6137
weighted avg       0.94      0.94      0.93      6137


LogisticRegression - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.94      1.00      0.97      1382
           1       0.98      0.42      0.59       153

    accuracy                           0.94      1535
   macro avg       0.96      0.71      0.78      1535
weighted avg       0.94      0.94      0.93      1535


LogisticRegression - Confusion Matrix on Test Data:
 [[1381    1]
 [  89   64]]

LogisticRegression - CV Mean Score: 0.9220, CV Std Score: 0.0159
🏃 View run LogisticRegression_FinalFeatures at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/8737167e14ad4cd4b60f3239e621e5c0
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training RidgeClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:35:22 INFO mlflow.sklearn.utils: Logging the 5 best runs, no runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run exultant-cod-997 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/434c0213a31548499d94d919fd0d9750
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run whimsical-stork-607 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/fecc5619ed56423599599563f91c6049
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run overjoyed-gull-860 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/dd3f1b8d93264831a0ee167563683f9b
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

RidgeClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.93      1.00      0.96      5523
           1       1.00      0.29      0.45       614

    accuracy                           0.93      6137
   macro avg       0.96      0.64      0.70      6137
weighted avg       0.93      0.93      0.91      6137


RidgeClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.93      1.00      0.96      1382
           1       1.00      0.32      0.49       153

    accuracy                           0.93      1535
   macro avg       0.97      0.66      0.72      1535
weighted avg       0.94      0.93      0.92      1535


RidgeClassifier - Confusion Matrix on Test Data:
 [[1382    0]
 [ 104   49]]

RidgeClassifier - CV Mean Score: 0.9267, CV Std Score: 0.0025
🏃 View run RidgeClassifier_FinalFeatures at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/dcca473bb86f42169be8e5f3f3500c4c
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training RandomForestClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:37:31 INFO mlflow.sklearn.utils: Logging the 5 best runs, one run will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run unique-skunk-188 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/2170629903af4fc89eaf839a994b09f9
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run salty-smelt-34 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/a3a2034503fd45918c12b69b0bb080a8
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run gentle-fish-395 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/ea3e8187b2b5488783176b05d13125e6
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run ambitious-owl-721 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/06137fcbe561453b854c3025586f16b1
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run capable-auk-637 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/5843df13d9c6487580896e57fb4f70e2
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

RandomForestClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       1.00      1.00      1.00      5523
           1       1.00      1.00      1.00       614

    accuracy                           1.00      6137
   macro avg       1.00      1.00      1.00      6137
weighted avg       1.00      1.00      1.00      6137


RandomForestClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      1.00      0.99      1382
           1       0.96      0.86      0.91       153

    accuracy                           0.98      1535
   macro avg       0.97      0.93      0.95      1535
weighted avg       0.98      0.98      0.98      1535


RandomForestClassifier - Confusion Matrix on Test Data:
 [[1377    5]
 [  22  131]]

RandomForestClassifier - CV Mean Score: 0.9809, CV Std Score: 0.0004
🏃 View run RandomForestClassifier_FinalFeatures at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/e7e23101ac16401abf27df2a2bbca3ad
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training XGBClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:38:58 INFO mlflow.sklearn.utils: Logging the 5 best runs, 13 runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run sneaky-stork-884 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/a85eb358ddc54644a57b3fa1e416fe74
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run bouncy-quail-933 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/b8c176b309e54fb4b0124a3e139f8a47
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run languid-cod-403 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/4b6b9d8bdc874ed2aa18f941c28a26d0
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run mysterious-finch-351 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/5dd8654cf35646c4a84edfdc3496a0f9
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run clean-pig-910 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/07da68d66908461abcb9bc06040f2c8a
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

XGBClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      1.00      0.99      5523
           1       0.98      0.86      0.92       614

    accuracy                           0.98      6137
   macro avg       0.98      0.93      0.95      6137
weighted avg       0.98      0.98      0.98      6137


XGBClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      1.00      0.99      1382
           1       0.98      0.84      0.91       153

    accuracy                           0.98      1535
   macro avg       0.98      0.92      0.95      1535
weighted avg       0.98      0.98      0.98      1535


XGBClassifier - Confusion Matrix on Test Data:
 [[1379    3]
 [  24  129]]

XGBClassifier - CV Mean Score: 0.9655, CV Std Score: 0.0289
🏃 View run XGBClassifier_FinalFeatures at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/2deb91901d244885a5b2739c4aaa07d7
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="c1"># Enable autologging for MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># Check if there is an active MLFlow run, and end it if necessary</span>
<span class="k">if</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">active_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>  <span class="c1"># Close the previous active run</span>

<span class="c1"># Step 2: Define categorical and numerical columns</span>
<span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">numerical_columns</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Step 3: Preprocessing pipeline</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>  <span class="c1"># Impute missing values</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>  <span class="c1"># Scale the data</span>
        <span class="p">]),</span> <span class="n">numerical_columns</span><span class="p">),</span>
        
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)),</span>  <span class="c1"># Impute missing values</span>
            <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>  <span class="c1"># One-Hot Encoding</span>
        <span class="p">]),</span> <span class="n">categorical_columns</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># Step 4: Apply preprocessing to the data</span>
<span class="n">X_processed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Step 5: Apply PCA for dimensionality reduction</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_processed</span><span class="p">)</span>

<span class="c1"># Step 6: Create Scree Plot to visualize explained variance ratio</span>
<span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">explained_variance_ratio</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained Variance Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Ensure the directory for saving the figure exists</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the figure locally in the &#39;output&#39; directory</span>
<span class="n">fig_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;scree_plot.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Step 7: Log PCA results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Start a new top-level run</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Log the PCA model and explained variance ratio</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;PCA_components&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;explained_variance_ratio&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span> <span class="s1">&#39;pca_model&#39;</span><span class="p">)</span>
    
    <span class="c1"># Log the scree plot image</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">fig_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MLFlow Run for PCA logged with explained variance ratio: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>  <span class="c1"># End the current MLFlow run</span>

<span class="c1"># Step 8: Select number of components based on scree plot</span>
<span class="n">pca_95</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>  <span class="c1"># Keep components that explain 95% variance</span>
<span class="n">X_pca_95</span> <span class="o">=</span> <span class="n">pca_95</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_processed</span><span class="p">)</span>

<span class="c1"># Step 9: Train a classifier with the reduced features</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_pca_95</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># RandomForestClassifier for classification</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Evaluate the model</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Log the classification results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Start a new top-level run</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;RandomForestClassifier with PCA&#39;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="s1">&#39;rf_model&#39;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Random Forest Accuracy with PCA: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>  <span class="c1"># End the current MLFlow run</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:39:29 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;cc063b90e07b4c05a07d9b4b4a427a92&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:39:33 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:39:33 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run kindly-colt-300 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/cc063b90e07b4c05a07d9b4b4a427a92
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:39:42 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;72a34d0dafa74ab68559ee4d96cb3501&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:39:46 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:39:46 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run dazzling-fox-901 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/72a34d0dafa74ab68559ee4d96cb3501
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:39:55 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;d6945e94876043daa7d5cc2ea5fc9bf9&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:39:59 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:39:59 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run unruly-cod-24 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/d6945e94876043daa7d5cc2ea5fc9bf9
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:40:10 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
2024/12/21 16:40:16 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MLFlow Run for PCA logged with explained variance ratio: 1.0
🏃 View run learned-croc-13 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/7f5d3d22d3864ad288ff828562451f4f
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:40:21 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;2f827467a4be4b8a9bdcf02726dc62d8&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:40:25 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:40:25 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run adventurous-doe-70 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/2f827467a4be4b8a9bdcf02726dc62d8
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:40:34 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;e766ae2c71284ced842c6d32e34b0a75&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:40:34 WARNING mlflow.sklearn: Failed to log training dataset information to MLflow Tracking. Reason: &#39;Series&#39; object has no attribute &#39;flatten&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run capricious-skink-144 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/e766ae2c71284ced842c6d32e34b0a75
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:40:59 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random Forest Accuracy with PCA: 0.9856677524429968
🏃 View run selective-shrike-452 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/69c24b8b266548ad8a2359e4580eb530
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="c1"># Enable autologging for MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># Check if there is an active MLFlow run, and end it if necessary</span>
<span class="k">if</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">active_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>  <span class="c1"># Close the previous active run</span>

<span class="c1"># Step 1: Define your data columns (categorical and numerical)</span>
<span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">numerical_columns</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Step 2: Preprocessing pipeline</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>  <span class="c1"># Impute missing values</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>  <span class="c1"># Scale the data</span>
        <span class="p">]),</span> <span class="n">numerical_columns</span><span class="p">),</span>
        
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)),</span>  <span class="c1"># Impute missing values</span>
            <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>  <span class="c1"># One-Hot Encoding</span>
        <span class="p">]),</span> <span class="n">categorical_columns</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># Step 3: Apply preprocessing to the data</span>
<span class="n">X_processed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Step 4: Apply PCA for dimensionality reduction</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_processed</span><span class="p">)</span>

<span class="c1"># Step 5: Create Scree Plot to visualize explained variance ratio</span>
<span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">explained_variance_ratio</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained Variance Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Ensure the directory for saving the figure exists</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the figure locally in the &#39;output&#39; directory</span>
<span class="n">fig_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;scree_plot_with_pca.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Step 6: Log PCA results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Start a new top-level run</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Log the PCA model and explained variance ratio</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;PCA_components&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;explained_variance_ratio&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span> <span class="s1">&#39;pca_model&#39;</span><span class="p">)</span>
    
    <span class="c1"># Log the scree plot image</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">fig_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MLFlow Run for PCA logged with explained variance ratio: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>  <span class="c1"># End the current MLFlow run</span>

<span class="c1"># Step 7: Select number of components based on scree plot</span>
<span class="c1"># For example, keep components that explain at least 95% of variance</span>
<span class="n">pca_95</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>  <span class="c1"># Keep components that explain 95% variance</span>
<span class="n">X_pca_95</span> <span class="o">=</span> <span class="n">pca_95</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_processed</span><span class="p">)</span>

<span class="c1"># Step 8: Train a classifier with the reduced features</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_pca_95</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># RandomForestClassifier for classification</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Evaluate the model</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Log the classification results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Start a new top-level run</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;RandomForestClassifier with PCA&#39;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="s1">&#39;rf_model&#39;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Random Forest Accuracy with PCA: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>  <span class="c1"># End the current MLFlow run</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:41:03 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;20903d7f3e44412f87b72b3e254a26b8&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:41:07 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:41:07 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run agreeable-slug-219 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/20903d7f3e44412f87b72b3e254a26b8
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:41:16 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;a8a4dd0df1914925ad6595dc6e2c6133&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:41:20 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:41:20 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run worried-fish-222 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/a8a4dd0df1914925ad6595dc6e2c6133
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:41:29 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;a1c48d92ecfe410483ba599ec2e1640d&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:41:33 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:41:33 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run delightful-trout-76 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/a1c48d92ecfe410483ba599ec2e1640d
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:41:44 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
2024/12/21 16:41:49 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MLFlow Run for PCA logged with explained variance ratio: 1.0
🏃 View run ambitious-swan-775 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/ed1fe3e442314d7bb3f9617c6cf9dc25
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:41:55 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;56e8ec5020f94a328cca164fb2cdf054&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:41:59 WARNING mlflow.sklearn: Training metrics will not be recorded because training labels were not specified. To automatically record training metrics, provide training labels as inputs to the model training function.
2024/12/21 16:41:59 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run kindly-squid-325 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/56e8ec5020f94a328cca164fb2cdf054
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:42:08 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;431c538c230f4cb29d7663d436188f07&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 16:42:08 WARNING mlflow.sklearn: Failed to log training dataset information to MLflow Tracking. Reason: &#39;Series&#39; object has no attribute &#39;flatten&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run hilarious-horse-52 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/431c538c230f4cb29d7663d436188f07
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:42:32 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random Forest Accuracy with PCA: 0.9863192182410423
🏃 View run enthused-eel-781 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/c47214852aef442dac56f76df40e2790
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Example data (replace X, y with your dataset)</span>
<span class="c1"># X = your_feature_data</span>
<span class="c1"># y = your_target_variable</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>


<span class="c1"># Step 4: Get the explained variance ratio</span>
<span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>

<span class="c1"># Step 5: Create the Scree Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">explained_variance_ratio</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained Variance Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Ensure the directory for saving the figure exists</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the figure locally</span>
<span class="n">fig_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;scree_plot.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Step 6: Log PCA results in MLFlow</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log the PCA components and explained variance ratio</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;PCA_components&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;explained_variance_ratio&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">))</span>
    
    <span class="c1"># Log the PCA model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span> <span class="s1">&#39;pca_model&#39;</span><span class="p">)</span>
    
    <span class="c1"># Log the scree plot image</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">fig_path</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MLFlow Run for PCA logged with explained variance ratio: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f63819426e9ad903c2b34b3cbad096ca5a3d0b7713017a935e1a6f020099523d.png" src="_images/f63819426e9ad903c2b34b3cbad096ca5a3d0b7713017a935e1a6f020099523d.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:42:39 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
2024/12/21 16:42:44 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MLFlow Run for PCA logged with explained variance ratio: 1.0
🏃 View run sassy-snail-147 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/2bf2ed834f454d469ed8ee0a706524f2
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_pca_components</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
<span class="n">x_pca_components</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.888598</td>
      <td>-0.307434</td>
      <td>-0.204524</td>
      <td>-0.144942</td>
      <td>-0.681655</td>
      <td>-0.479859</td>
      <td>0.841081</td>
      <td>0.057240</td>
      <td>-0.161674</td>
      <td>-0.146485</td>
      <td>-7.240291e-18</td>
      <td>2.508127e-16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.030050</td>
      <td>-0.183686</td>
      <td>-0.730066</td>
      <td>1.584324</td>
      <td>0.762007</td>
      <td>-0.343500</td>
      <td>-0.372336</td>
      <td>0.695392</td>
      <td>-0.309045</td>
      <td>-0.190644</td>
      <td>4.291285e-16</td>
      <td>-2.615813e-16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.594186</td>
      <td>0.843583</td>
      <td>-0.468941</td>
      <td>0.024345</td>
      <td>-0.696552</td>
      <td>-0.466896</td>
      <td>-0.081873</td>
      <td>-0.004004</td>
      <td>0.127852</td>
      <td>0.891893</td>
      <td>1.240311e-16</td>
      <td>-2.497362e-16</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.086846</td>
      <td>-0.619487</td>
      <td>-0.213094</td>
      <td>0.586307</td>
      <td>-0.067461</td>
      <td>0.806442</td>
      <td>0.878130</td>
      <td>0.043388</td>
      <td>-0.178472</td>
      <td>-0.157510</td>
      <td>-4.908020e-16</td>
      <td>-7.572423e-17</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.737486</td>
      <td>-1.057390</td>
      <td>0.306160</td>
      <td>-1.579407</td>
      <td>-0.041782</td>
      <td>0.835867</td>
      <td>-0.090145</td>
      <td>-0.069091</td>
      <td>0.812497</td>
      <td>-0.322582</td>
      <td>6.917517e-15</td>
      <td>-1.916482e-15</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7667</th>
      <td>0.279483</td>
      <td>0.033960</td>
      <td>0.480691</td>
      <td>0.397712</td>
      <td>-0.038366</td>
      <td>0.820836</td>
      <td>-0.093345</td>
      <td>-0.056683</td>
      <td>0.823012</td>
      <td>-0.328896</td>
      <td>-6.140958e-17</td>
      <td>-1.242847e-17</td>
    </tr>
    <tr>
      <th>7668</th>
      <td>0.022411</td>
      <td>0.676510</td>
      <td>0.843579</td>
      <td>-1.083374</td>
      <td>-0.052771</td>
      <td>0.815404</td>
      <td>-0.101914</td>
      <td>-0.049321</td>
      <td>0.808567</td>
      <td>-0.309734</td>
      <td>-8.912787e-17</td>
      <td>5.284769e-17</td>
    </tr>
    <tr>
      <th>7669</th>
      <td>0.059337</td>
      <td>0.058315</td>
      <td>-0.078199</td>
      <td>0.140900</td>
      <td>-0.078632</td>
      <td>0.800408</td>
      <td>0.870366</td>
      <td>0.050921</td>
      <td>-0.185798</td>
      <td>-0.148846</td>
      <td>5.883338e-17</td>
      <td>-4.661895e-17</td>
    </tr>
    <tr>
      <th>7670</th>
      <td>-0.001328</td>
      <td>-2.003357</td>
      <td>-2.729763</td>
      <td>0.397944</td>
      <td>0.696957</td>
      <td>-0.330327</td>
      <td>0.857700</td>
      <td>0.003712</td>
      <td>-0.188643</td>
      <td>-0.191586</td>
      <td>7.920630e-17</td>
      <td>-2.684419e-17</td>
    </tr>
    <tr>
      <th>7671</th>
      <td>3.069674</td>
      <td>2.486479</td>
      <td>4.769128</td>
      <td>1.145098</td>
      <td>-0.598687</td>
      <td>-0.490216</td>
      <td>-0.381975</td>
      <td>0.787280</td>
      <td>-0.310148</td>
      <td>-0.132741</td>
      <td>5.792476e-17</td>
      <td>6.221594e-18</td>
    </tr>
  </tbody>
</table>
<p>7672 rows × 12 columns</p>
</div></div></div>
</div>
<section id="hence-from-the-scree-plot-the-elbow-is-forming-at-12-hence-first-12-features-explain-the-95-of-the-variance-and-it-gives-the-accuracy-of-98-5-with-random-forest-classifier">
<h2>Hence from the scree plot the elbow is forming at 12, hence first 12 features explain the 95% of the variance and it gives the accuracy of 98.5% with Random Forest Classifier<a class="headerlink" href="#hence-from-the-scree-plot-the-elbow-is-forming-at-12-hence-first-12-features-explain-the-95-of-the-variance-and-it-gives-the-accuracy-of-98-5-with-random-forest-classifier" title="Link to this heading">#</a></h2>
</section>
</section>
<section id="custom-experiment">
<h1>Custom Experiment<a class="headerlink" href="#custom-experiment" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>

<span class="c1"># Enable autologging for scikit-learn</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># Define classifiers to test (added DecisionTreeClassifier)</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DecisionTreeClassifier&#39;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>  <span class="c1"># Added DecisionTreeClassifier</span>
<span class="p">}</span>

<span class="c1"># Hyperparameter grid for each classifier</span>
<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    
    <span class="s1">&#39;DecisionTreeClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>  <span class="c1"># Hyperparameters for DecisionTreeClassifier</span>
        <span class="s1">&#39;classifier__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s1">&#39;classifier__min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Iterate over each classifier</span>
<span class="k">for</span> <span class="n">clf_name</span><span class="p">,</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the pipeline with preprocessing and the classifier</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span>
    <span class="p">])</span>
    
    <span class="c1"># Get the corresponding parameter grid</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span>
    
    <span class="c1"># Perform GridSearchCV for hyperparameter tuning with 10-fold cross-validation</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use n_jobs=1 to avoid parallel execution</span>
    
    <span class="c1"># Start an MLflow run</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
        <span class="c1"># Fit the model on the entire training set with hyperparameter tuning</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Log the best hyperparameters and score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;best_score&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
        
        <span class="c1"># Evaluate the model performance on the training data</span>
        <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Training Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">))</span>
        
        <span class="c1"># Log training classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_train_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
        
        <span class="c1"># Evaluate the model performance on the test data</span>
        <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Test Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>
        
        <span class="c1"># Log test classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_test_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
        
        <span class="c1"># Confusion matrix for the test data</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Confusion Matrix on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cm</span><span class="p">)</span>
        
        <span class="c1"># Log confusion matrix image</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Predicted 0&#39;</span><span class="p">,</span> <span class="s1">&#39;Predicted 1&#39;</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;True 0&#39;</span><span class="p">,</span> <span class="s1">&#39;True 1&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1"> - Confusion Matrix&#39;</span><span class="p">)</span>
        <span class="n">cm_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">_confusion_matrix.png&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">cm_filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">cm_filename</span><span class="p">)</span>
        
        <span class="c1"># Cross-validation results: mean and standard deviation</span>
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span>
        <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="n">std_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - CV Mean Score: </span><span class="si">{</span><span class="n">mean_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, CV Std Score: </span><span class="si">{</span><span class="n">std_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Log CV mean and std score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_mean_score&#39;</span><span class="p">,</span> <span class="n">mean_score</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_std_score&#39;</span><span class="p">,</span> <span class="n">std_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training DecisionTreeClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:49:16 INFO mlflow.sklearn.utils: Logging the 5 best runs, 11 runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run sincere-rat-341 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/580ec88fdffb47f29a1ddfffdadcf582
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run treasured-auk-8 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/5834c863c995479eb9b4a9d355147be6
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run languid-lamb-953 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/2f1db94610e745b58981e75cd1a307f4
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run luminous-jay-334 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/f27761d4ac554313870271f0ef68e91c
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run bittersweet-hare-330 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/88cff06c4aef4f9ab27f744f73aa6ea2
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

DecisionTreeClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      5523
           1       1.00      0.88      0.94       614

    accuracy                           0.99      6137
   macro avg       0.99      0.94      0.97      6137
weighted avg       0.99      0.99      0.99      6137


DecisionTreeClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      0.99      0.99      1382
           1       0.95      0.80      0.87       153

    accuracy                           0.98      1535
   macro avg       0.96      0.90      0.93      1535
weighted avg       0.98      0.98      0.98      1535


DecisionTreeClassifier - Confusion Matrix on Test Data:
 [[1375    7]
 [  30  123]]

DecisionTreeClassifier - CV Mean Score: 0.9742, CV Std Score: 0.0042
🏃 View run stately-bass-211 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/eb43ba177bf54fb9aa4bfacebb02f800
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">QuadraticDiscriminantAnalysis</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># Define classifiers to test</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;SVC&#39;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">(),</span>
    <span class="s1">&#39;KNeighborsClassifier&#39;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
    <span class="s1">&#39;GaussianNB&#39;</span><span class="p">:</span> <span class="n">GaussianNB</span><span class="p">(),</span>
    <span class="s1">&#39;GradientBoostingClassifier&#39;</span><span class="p">:</span> <span class="n">GradientBoostingClassifier</span><span class="p">(),</span>
    <span class="s1">&#39;AdaBoostClassifier&#39;</span><span class="p">:</span> <span class="n">AdaBoostClassifier</span><span class="p">(),</span>
    <span class="s1">&#39;QDA&#39;</span><span class="p">:</span> <span class="n">QuadraticDiscriminantAnalysis</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Hyperparameter grid for each classifier</span>
<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s1">&#39;SVC&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
        <span class="s1">&#39;classifier__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
        <span class="s1">&#39;classifier__gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;KNeighborsClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s1">&#39;classifier__metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;manhattan&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;GaussianNB&#39;</span><span class="p">:</span> <span class="p">{},</span>

    <span class="s1">&#39;GradientBoostingClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;AdaBoostClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="p">},</span>

    <span class="s1">&#39;QDA&#39;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>


<span class="c1"># Iterate over each classifier</span>
<span class="k">for</span> <span class="n">clf_name</span><span class="p">,</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the pipeline with preprocessing and the classifier</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span>
    <span class="p">])</span>
    
    <span class="c1"># Get the corresponding parameter grid</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span>
    
    <span class="c1"># Perform GridSearchCV for hyperparameter tuning with 10-fold cross-validation</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use n_jobs=1 to avoid parallel execution</span>
    
    <span class="c1"># Start an MLflow run</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
        <span class="c1"># Fit the model on the entire training set with hyperparameter tuning</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Log the best hyperparameters and score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;best_score&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
        
        <span class="c1"># Evaluate the model performance on the training data</span>
        <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Training Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">))</span>
        
        <span class="c1"># Log training classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_train_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
        
        <span class="c1"># Evaluate the model performance on the test data</span>
        <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Test Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>
        
        <span class="c1"># Log test classification report</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_test_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
        
        <span class="c1"># Confusion matrix for the test data</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Confusion Matrix on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cm</span><span class="p">)</span>
        
        
        <span class="c1"># Cross-validation results: mean and standard deviation</span>
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span>
        <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="n">std_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - CV Mean Score: </span><span class="si">{</span><span class="n">mean_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, CV Std Score: </span><span class="si">{</span><span class="n">std_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Log CV mean and std score</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_mean_score&#39;</span><span class="p">,</span> <span class="n">mean_score</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_std_score&#39;</span><span class="p">,</span> <span class="n">std_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training SVC...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:51:56 INFO mlflow.sklearn.utils: Logging the 5 best runs, 7 runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run persistent-stork-313 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/0fe248d15a344bc483b013a8c525a634
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run tasteful-auk-618 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/347e8d0a2cb549e2af535b5ff01ad76a
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run learned-hound-6 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/ccf0515465fb48a6a4c86cf929786379
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run nosy-roo-491 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/85dae5a099c94fbcb0afb36b66cb62e3
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run delicate-stork-851 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/d93bef3af6f045559ff9fe6137371e65
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

SVC - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      5523
           1       0.99      0.88      0.93       614

    accuracy                           0.99      6137
   macro avg       0.99      0.94      0.96      6137
weighted avg       0.99      0.99      0.99      6137


SVC - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      1.00      0.99      1382
           1       0.99      0.84      0.91       153

    accuracy                           0.98      1535
   macro avg       0.99      0.92      0.95      1535
weighted avg       0.98      0.98      0.98      1535


SVC - Confusion Matrix on Test Data:
 [[1381    1]
 [  24  129]]

SVC - CV Mean Score: 0.9602, CV Std Score: 0.0240
🏃 View run bold-mole-235 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/b8a8372cdbde427390fd093bbf47bf08
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training KNeighborsClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:52:53 INFO mlflow.sklearn.utils: Logging the 5 best runs, one run will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run puzzled-crow-136 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/2540088e4d074f038204a19ec1d91c22
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run unleashed-elk-693 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/5d437c7f107449eab6930015a8cb5571
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run capricious-stag-8 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/26dd097c85e24f9fbe564b896bf79cb0
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run handsome-fox-633 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/f39aacda64344ba6a0857d8a109e242f
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run angry-jay-619 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/9abe0e21e5e8485394d5551448096452
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

KNeighborsClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      1.00      0.99      5523
           1       1.00      0.82      0.90       614

    accuracy                           0.98      6137
   macro avg       0.99      0.91      0.94      6137
weighted avg       0.98      0.98      0.98      6137


KNeighborsClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.97      1.00      0.99      1382
           1       0.98      0.75      0.85       153

    accuracy                           0.97      1535
   macro avg       0.98      0.88      0.92      1535
weighted avg       0.97      0.97      0.97      1535


KNeighborsClassifier - Confusion Matrix on Test Data:
 [[1380    2]
 [  38  115]]

KNeighborsClassifier - CV Mean Score: 0.9663, CV Std Score: 0.0069
🏃 View run invincible-finch-309 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/602485f741064a73a2a5b6690e311eff
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training GaussianNB...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 16:53:47 INFO mlflow.sklearn.utils: Logging the 5 best runs, no runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run rogue-ape-202 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/5495c73be9594e2ebf52ffd188efd8ff
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

GaussianNB - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      5523
           1       0.96      0.89      0.92       614

    accuracy                           0.98      6137
   macro avg       0.97      0.94      0.96      6137
weighted avg       0.98      0.98      0.98      6137


GaussianNB - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      1382
           1       0.99      0.88      0.93       153

    accuracy                           0.99      1535
   macro avg       0.99      0.94      0.96      1535
weighted avg       0.99      0.99      0.99      1535


GaussianNB - Confusion Matrix on Test Data:
 [[1380    2]
 [  18  135]]

GaussianNB - CV Mean Score: 0.9850, CV Std Score: 0.0000
🏃 View run intelligent-ox-543 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/4f7e26ef48184f9c84d07d39885d1802
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training GradientBoostingClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 17:02:20 INFO mlflow.sklearn.utils: Logging the 5 best runs, 13 runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run secretive-vole-543 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/6fb6ed62f7f0431a830c27990d2a0825
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run gregarious-calf-599 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/7ef125fc80b14ea48ee27d0275d6d2d1
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run treasured-colt-569 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/a8ac8c098e524e64a168b5c732c2af0b
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run marvelous-sponge-505 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/3e748c5f2b9240eda9180416dc6fe1fa
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run youthful-sloth-619 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/19227e36bd9943bc963d3bb31ef7dbde
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

GradientBoostingClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      1.00      5523
           1       0.99      0.93      0.96       614

    accuracy                           0.99      6137
   macro avg       0.99      0.97      0.98      6137
weighted avg       0.99      0.99      0.99      6137


GradientBoostingClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      1382
           1       0.97      0.87      0.92       153

    accuracy                           0.98      1535
   macro avg       0.98      0.93      0.95      1535
weighted avg       0.98      0.98      0.98      1535


GradientBoostingClassifier - Confusion Matrix on Test Data:
 [[1378    4]
 [  20  133]]

GradientBoostingClassifier - CV Mean Score: 0.9655, CV Std Score: 0.0284
🏃 View run burly-pig-544 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/307596c073f24210badf26f37eac97f0
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training AdaBoostClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 17:03:53 INFO mlflow.sklearn.utils: Logging the 5 best runs, one run will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run dashing-toad-743 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/16780f1f316e4567b6ad1584597651be
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run vaunted-asp-249 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/1d41d27df2ed40de90279767bdaa726c
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run upset-sheep-123 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/035b303b0f7e48648d424dc04e06f5bd
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run amazing-kite-712 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/dc77bf6a3cb145d6956dd1423ba330bf
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
🏃 View run sincere-snake-760 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/1ea3533db8764534829938e1e02de301
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

AdaBoostClassifier - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      5523
           1       0.98      0.90      0.93       614

    accuracy                           0.99      6137
   macro avg       0.98      0.95      0.96      6137
weighted avg       0.99      0.99      0.99      6137


AdaBoostClassifier - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      0.99      0.99      1382
           1       0.95      0.88      0.92       153

    accuracy                           0.98      1535
   macro avg       0.97      0.94      0.95      1535
weighted avg       0.98      0.98      0.98      1535


AdaBoostClassifier - Confusion Matrix on Test Data:
 [[1375    7]
 [  18  135]]

AdaBoostClassifier - CV Mean Score: 0.9643, CV Std Score: 0.0197
🏃 View run enthused-lark-537 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/fc2d055016c243ef898039ded7d13658
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

Training QDA...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
C:\Users\Yaseen\anaconda3\Lib\site-packages\sklearn\discriminant_analysis.py:926: UserWarning: Variables are collinear
  warnings.warn(&quot;Variables are collinear&quot;)
2024/12/21 17:04:45 INFO mlflow.sklearn.utils: Logging the 5 best runs, no runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run aged-cat-770 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/b9a7da8200c6451a87b90071adb22083
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

QDA - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      0.97      0.97      5523
           1       0.73      0.81      0.77       614

    accuracy                           0.95      6137
   macro avg       0.86      0.89      0.87      6137
weighted avg       0.95      0.95      0.95      6137


QDA - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.98      0.96      0.97      1382
           1       0.72      0.82      0.76       153

    accuracy                           0.95      1535
   macro avg       0.85      0.89      0.87      1535
weighted avg       0.95      0.95      0.95      1535


QDA - Confusion Matrix on Test Data:
 [[1333   49]
 [  28  125]]

QDA - CV Mean Score: 0.8892, CV Std Score: 0.0000
🏃 View run amusing-colt-842 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/e9a3b08a001345958188566e267b41fb
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Enable autologging for MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">()</span>


<span class="c1"># Define numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;vibration&#39;</span><span class="p">,</span> <span class="s1">&#39;humidity&#39;</span><span class="p">]</span>  <span class="c1"># Replace with your actual numerical features</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">,</span> <span class="s1">&#39;location_name&#39;</span><span class="p">]</span>  <span class="c1"># Replace with your actual categorical features</span>

<span class="c1"># Define the preprocessor pipeline for numerical columns</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>  <span class="c1"># Handle missing values</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Standardize the data</span>
    <span class="p">(</span><span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">())</span>  <span class="c1"># Min-Max scaling (if required, can be adjusted)</span>
<span class="p">])</span>


<span class="c1"># Define the preprocessor pipeline for categorical columns</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;missing&#39;</span><span class="p">)),</span>  <span class="c1"># Handle missing values</span>
    <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>  <span class="c1"># One-hot encode categorical features</span>
<span class="p">])</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>


<span class="c1"># Define the classifier (GaussianNB)</span>
<span class="n">clf_name</span> <span class="o">=</span> <span class="s1">&#39;GaussianNB&#39;</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>

<span class="c1"># Hyperparameter grid for GaussianNB (no hyperparameters for grid search)</span>
<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;GaussianNB&#39;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1"># Create the pipeline with preprocessing and the classifier</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Get the corresponding parameter grid</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">clf_name</span><span class="p">]</span>

<span class="c1"># Perform GridSearchCV for hyperparameter tuning with 10-fold cross-validation</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use n_jobs=1 to avoid parallel execution</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Fit the model on the entire training set with hyperparameter tuning</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># Log the best hyperparameters and score</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;best_score&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
    
    <span class="c1"># Evaluate the model performance on the training data</span>
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Training Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">))</span>
    
    <span class="c1"># Log training classification report</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_train_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
    
    <span class="c1"># Evaluate the model performance on the test data</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Test Data Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>
    
    <span class="c1"># Log test classification report</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_test_accuracy&#39;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
    
    <span class="c1"># Confusion matrix for the test data</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - Confusion Matrix on Test Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cm</span><span class="p">)</span>
    
    
    <span class="c1"># Cross-validation results: mean and standard deviation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span>
    <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
    <span class="n">std_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> - CV Mean Score: </span><span class="si">{</span><span class="n">mean_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, CV Std Score: </span><span class="si">{</span><span class="n">std_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Log CV mean and std score</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_mean_score&#39;</span><span class="p">,</span> <span class="n">mean_score</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s1">_cv_std_score&#39;</span><span class="p">,</span> <span class="n">std_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 17:05:25 INFO mlflow.sklearn.utils: Logging the 5 best runs, no runs will be omitted.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run fun-foal-429 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/5130589830754980a61df75d6dbe3b30
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0

GaussianNB - Training Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      5523
           1       0.96      0.89      0.92       614

    accuracy                           0.98      6137
   macro avg       0.97      0.94      0.96      6137
weighted avg       0.98      0.98      0.98      6137


GaussianNB - Test Data Classification Report:
               precision    recall  f1-score   support

           0       0.99      1.00      0.99      1382
           1       0.99      0.88      0.93       153

    accuracy                           0.99      1535
   macro avg       0.99      0.94      0.96      1535
weighted avg       0.99      0.99      0.99      1535


GaussianNB - Confusion Matrix on Test Data:
 [[1380    2]
 [  18  135]]

GaussianNB - CV Mean Score: 0.9850, CV Std Score: 0.0000
🏃 View run tasteful-croc-527 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/ef069816c77c4ad89e3d65199383e450
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Save the best pipeline model</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;gaussian_nb_model.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">])</span>  <span class="c1"># Adjust &quot;preprocessor&quot; to the name of your ColumnTransformer in the pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ColumnTransformer(transformers=[(&#39;num&#39;,
                                 Pipeline(steps=[(&#39;imputer&#39;, SimpleImputer()),
                                                 (&#39;scaler&#39;, StandardScaler()),
                                                 (&#39;minmax&#39;, MinMaxScaler())]),
                                 [&#39;temperature&#39;, &#39;pressure&#39;, &#39;vibration&#39;,
                                  &#39;humidity&#39;]),
                                (&#39;cat&#39;,
                                 Pipeline(steps=[(&#39;imputer&#39;,
                                                  SimpleImputer(fill_value=&#39;missing&#39;,
                                                                strategy=&#39;constant&#39;)),
                                                 (&#39;onehot&#39;,
                                                  OneHotEncoder(handle_unknown=&#39;ignore&#39;))]),
                                 [&#39;equipment_name&#39;, &#39;location_name&#39;])])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3458    0
636     0
4884    0
3962    0
6287    0
       ..
1924    0
548     0
3890    0
1042    1
3274    0
Name: faulty, Length: 6137, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipment_name</th>
      <th>location_name</th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3458</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>68.596249</td>
      <td>29.624662</td>
      <td>0.986966</td>
      <td>58.204381</td>
    </tr>
    <tr>
      <th>636</th>
      <td>Pump</td>
      <td>Chicago</td>
      <td>71.373525</td>
      <td>24.384980</td>
      <td>1.892085</td>
      <td>37.355447</td>
    </tr>
    <tr>
      <th>4884</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>74.395012</td>
      <td>36.446969</td>
      <td>1.571815</td>
      <td>67.199845</td>
    </tr>
    <tr>
      <th>3962</th>
      <td>Turbine</td>
      <td>San Francisco</td>
      <td>71.915774</td>
      <td>28.193738</td>
      <td>1.583522</td>
      <td>46.086696</td>
    </tr>
    <tr>
      <th>6287</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>53.660770</td>
      <td>24.401336</td>
      <td>2.088785</td>
      <td>30.704903</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1924</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>70.210038</td>
      <td>43.853683</td>
      <td>1.371703</td>
      <td>51.479689</td>
    </tr>
    <tr>
      <th>548</th>
      <td>Pump</td>
      <td>New York</td>
      <td>61.657182</td>
      <td>37.560466</td>
      <td>1.504645</td>
      <td>62.323792</td>
    </tr>
    <tr>
      <th>3890</th>
      <td>Pump</td>
      <td>Chicago</td>
      <td>55.612799</td>
      <td>32.017794</td>
      <td>1.341727</td>
      <td>61.901096</td>
    </tr>
    <tr>
      <th>1042</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>79.852850</td>
      <td>65.143210</td>
      <td>1.024907</td>
      <td>71.990642</td>
    </tr>
    <tr>
      <th>3274</th>
      <td>Pump</td>
      <td>Houston</td>
      <td>56.097781</td>
      <td>36.732438</td>
      <td>1.746475</td>
      <td>42.390570</td>
    </tr>
  </tbody>
</table>
<p>6137 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Assume this is your data schema</span>
<span class="c1"># First column is categorical, second is categorical, rest are numerical</span>
<span class="n">categorical_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Example: &#39;Type&#39;, &#39;Location&#39;</span>
<span class="n">numerical_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># Example: other numerical features</span>

<span class="c1"># Define the preprocessing pipeline</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_indices</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_indices</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span>  <span class="c1"># Ensure other columns pass through if not specified</span>
<span class="p">)</span>

<span class="c1"># Create the final pipeline</span>
<span class="n">model_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())</span>
<span class="p">])</span>


<span class="c1"># Convert to numpy array for consistent processing (optional but recommended)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># Fit the pipeline</span>
<span class="n">model_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Save the pipeline</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">,</span> <span class="s1">&#39;gaussian_nb_pipeline.pkl&#39;</span><span class="p">)</span>

<span class="c1"># Predict on new input</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Turbine&#39;</span><span class="p">,</span> <span class="s1">&#39;Atlanta&#39;</span><span class="p">,</span> <span class="mf">68.596249</span><span class="p">,</span> <span class="mf">29.624662</span><span class="p">,</span> <span class="mf">0.986966</span><span class="p">,</span> <span class="mf">58.204381</span><span class="p">]]</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>  <span class="c1"># Ensure consistent input format</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction:&quot;</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/21 17:36:34 INFO mlflow.utils.autologging_utils: Created MLflow autologging run with ID &#39;7402d0febb3849ac885808dad401966e&#39;, which will track hyperparameters, performance metrics, model artifacts, and lineage information for the current sklearn workflow
2024/12/21 17:36:34 WARNING mlflow.sklearn: Failed to log training dataset information to MLflow Tracking. Reason: &#39;Series&#39; object has no attribute &#39;flatten&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run gentle-lamb-515 at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0/runs/7402d0febb3849ac885808dad401966e
🧪 View experiment at: https://dagshub.com/yaseensiddiqui36/my-first-repo.mlflow/#/experiments/0
Prediction: [0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="s1">&#39;gaussian_nb_pipeline.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;gaussian_nb_pipeline.pkl&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_pipeline</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;gaussian_nb_pipeline.pkl&#39;</span><span class="p">)</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Turbine&#39;</span><span class="p">,</span> <span class="s1">&#39;Atlanta&#39;</span><span class="p">,</span><span class="mf">68.596249</span><span class="p">,</span> <span class="mf">29.624662</span><span class="p">,</span> <span class="mf">0.986966</span><span class="p">,</span> <span class="mf">58.204381</span><span class="p">]]</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_input</span><span class="p">))</span>
<span class="n">prediction</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0], dtype=int64)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sample_input</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RangeIndex(start=0, stop=6, step=1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipment_name</th>
      <th>location_name</th>
      <th>temperature</th>
      <th>pressure</th>
      <th>vibration</th>
      <th>humidity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3458</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>68.596249</td>
      <td>29.624662</td>
      <td>0.986966</td>
      <td>58.204381</td>
    </tr>
    <tr>
      <th>636</th>
      <td>Pump</td>
      <td>Chicago</td>
      <td>71.373525</td>
      <td>24.384980</td>
      <td>1.892085</td>
      <td>37.355447</td>
    </tr>
    <tr>
      <th>4884</th>
      <td>Turbine</td>
      <td>Atlanta</td>
      <td>74.395012</td>
      <td>36.446969</td>
      <td>1.571815</td>
      <td>67.199845</td>
    </tr>
    <tr>
      <th>3962</th>
      <td>Turbine</td>
      <td>San Francisco</td>
      <td>71.915774</td>
      <td>28.193738</td>
      <td>1.583522</td>
      <td>46.086696</td>
    </tr>
    <tr>
      <th>6287</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>53.660770</td>
      <td>24.401336</td>
      <td>2.088785</td>
      <td>30.704903</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1924</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>70.210038</td>
      <td>43.853683</td>
      <td>1.371703</td>
      <td>51.479689</td>
    </tr>
    <tr>
      <th>548</th>
      <td>Pump</td>
      <td>New York</td>
      <td>61.657182</td>
      <td>37.560466</td>
      <td>1.504645</td>
      <td>62.323792</td>
    </tr>
    <tr>
      <th>3890</th>
      <td>Pump</td>
      <td>Chicago</td>
      <td>55.612799</td>
      <td>32.017794</td>
      <td>1.341727</td>
      <td>61.901096</td>
    </tr>
    <tr>
      <th>1042</th>
      <td>Pump</td>
      <td>Atlanta</td>
      <td>79.852850</td>
      <td>65.143210</td>
      <td>1.024907</td>
      <td>71.990642</td>
    </tr>
    <tr>
      <th>3274</th>
      <td>Pump</td>
      <td>Houston</td>
      <td>56.097781</td>
      <td>36.732438</td>
      <td>1.746475</td>
      <td>42.390570</td>
    </tr>
  </tbody>
</table>
<p>6137 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sample_input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
1
2
3
4
5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Assuming sample_input is a DataFrame, make sure it has the correct columns</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">20.5</span><span class="p">],</span>
    <span class="s1">&#39;pressure&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">101.2</span><span class="p">],</span>
    <span class="s1">&#39;vibration&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.02</span><span class="p">],</span>
    <span class="s1">&#39;humidity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">60</span><span class="p">],</span>
    <span class="s1">&#39;equipment_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Pump&#39;</span><span class="p">],</span>
    <span class="s1">&#39;location_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Factory&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sample_input</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>  <span class="c1"># Check the columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example of fitting the preprocessor on training data before prediction</span>
<span class="n">preprocessor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># Then apply the preprocessor on sample_input for prediction</span>
<span class="n">transformed_input</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="n">sample_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;equipment_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Turbine&quot;</span><span class="p">,</span> <span class="s2">&quot;location_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Atlanta&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">68.596249</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="mf">29.624662</span><span class="p">,</span> <span class="s2">&quot;vibration&quot;</span><span class="p">:</span> <span class="mf">0.986966</span><span class="p">,</span> <span class="s2">&quot;humidity&quot;</span><span class="p">:</span> <span class="mf">58.204381</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;equipment_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Pump&quot;</span><span class="p">,</span> <span class="s2">&quot;location_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Chicago&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">71.373525</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="mf">24.384980</span><span class="p">,</span> <span class="s2">&quot;vibration&quot;</span><span class="p">:</span> <span class="mf">1.892085</span><span class="p">,</span> <span class="s2">&quot;humidity&quot;</span><span class="p">:</span> <span class="mf">37.355447</span><span class="p">},</span>
<span class="p">]</span>

<span class="c1"># Process and prepare the data (example preprocessing)</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;vibration&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;humidity&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">sample_data</span><span class="p">]</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;equipment_name&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;location_name&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">sample_data</span><span class="p">]</span>

<span class="c1"># Combine numerical and categorical features</span>
<span class="c1"># You must apply the same preprocessing used during training</span>
<span class="c1"># Assuming `preprocessor` was used during training, load it if available</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">load</span>
    <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;preprocessor.pkl&quot;</span><span class="p">)</span>  <span class="c1"># Preprocessor file if saved</span>
    <span class="n">input_features</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">numerical_features</span> <span class="o">+</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">input_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">numerical_features</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">))</span>  <span class="c1"># Fallback for unprocessed data</span>

<span class="c1"># Make predictions</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predictions:&quot;</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction failed: &#39;numpy.ndarray&#39; object has no attribute &#39;predict&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assuming `preprocessor` is correctly fitted</span>
<span class="n">transformed_input</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NotFittedError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Assuming `preprocessor` is correctly fitted</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">transformed_input</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_input</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\sklearn\utils\_set_output.py:140,</span> in <span class="ni">_wrap_method_output.&lt;locals&gt;.wrapped</span><span class="nt">(self, X, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span> <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">140</span>     <span class="n">data_to_wrap</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_to_wrap</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span>         <span class="c1"># only wrap the first output for cross decomposition</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span>         <span class="k">return</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>             <span class="n">_wrap_data_with_container</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">data_to_wrap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>             <span class="o">*</span><span class="n">data_to_wrap</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span>         <span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\sklearn\compose\_column_transformer.py:770,</span> in <span class="ni">ColumnTransformer.transform</span><span class="nt">(self, X)</span>
<span class="g g-Whitespace">    </span><span class="mi">753</span> <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">754</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Transform X separately by each transformer, concatenate results.</span>
<span class="g g-Whitespace">    </span><span class="mi">755</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">756</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">768</span><span class="sd">         sparse matrices.</span>
<span class="g g-Whitespace">    </span><span class="mi">769</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">770</span>     <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">771</span>     <span class="n">X</span> <span class="o">=</span> <span class="n">_check_X</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">773</span>     <span class="n">fit_dataframe_and_transform_dataframe</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">774</span>         <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;feature_names_in_&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">775</span>     <span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;columns&quot;</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\sklearn\utils\validation.py:1390,</span> in <span class="ni">check_is_fitted</span><span class="nt">(estimator, attributes, msg, all_or_any)</span>
<span class="g g-Whitespace">   </span><span class="mi">1385</span>     <span class="n">fitted</span> <span class="o">=</span> <span class="p">[</span>
<span class="nn">   1386         v for v</span> in <span class="ni">vars(estimator) if v.endswith(&quot;_&quot;) and not v.startswith</span><span class="nt">(&quot;__&quot;)</span>
<span class="g g-Whitespace">   </span><span class="mi">1387</span>     <span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1389</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fitted</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1390</span>     <span class="k">raise</span> <span class="n">NotFittedError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">})</span>

<span class="ne">NotFittedError</span>: This ColumnTransformer instance is not fitted yet. Call &#39;fit&#39; with appropriate arguments before using this estimator.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Load the saved model</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;gaussian_nb_model.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="c1"># Ensure input matches expected schema</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">&quot;Pump&quot;</span><span class="p">,</span><span class="s2">&quot;New York&quot;</span><span class="p">,</span><span class="mf">100.5</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">45.2</span> <span class="p">]])</span>  <span class="c1"># Adjust to match your features</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction: </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">91</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># Ensure input matches expected schema</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">sample_input</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">&quot;Pump&quot;</span><span class="p">,</span><span class="s2">&quot;New York&quot;</span><span class="p">,</span><span class="mf">100.5</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">45.2</span> <span class="p">]])</span>  <span class="c1"># Adjust to match your features</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction: </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">AttributeError</span>: &#39;numpy.ndarray&#39; object has no attribute &#39;predict&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Save the trained model</span>
<span class="n">model_filename</span> <span class="o">=</span> <span class="s1">&#39;gaussian_nb_model.pkl&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span> <span class="p">,</span> <span class="n">model_filename</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model saved as </span><span class="si">{</span><span class="n">model_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as gaussian_nb_model.pkl
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_model_reloaded</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;gaussian_nb_model.pk1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Load the model</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;gaussian_nb_model.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># Test prediction</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">100.5</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">45.2</span><span class="p">,</span> <span class="s2">&quot;Pump&quot;</span><span class="p">,</span> <span class="s2">&quot;New York&quot;</span><span class="p">]]</span>  <span class="c1"># Adjust to match input schema</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction: </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">fastapi</span> <span class="n">uvicorn</span> <span class="n">joblib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Load the saved model (GaussianNB with preprocessing)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;gaussian_nb_model.joblib&#39;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1"># Define the input data schema</span>
<span class="k">class</span> <span class="nc">PredictionRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">features</span><span class="p">:</span> <span class="nb">list</span>

<span class="c1"># Define the prediction endpoint</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">PredictionRequest</span><span class="p">):</span>
    <span class="c1"># Extract the features from the request</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">features</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Make prediction using the trained model</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="n">prediction</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Welcome to your Jupyter Book</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Creating the tables in the database following the 3NF form</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-create-3-tables">We will create 3 tables:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#newly-created-normalized-database-in-3nf-form-with-tables-location-equipment-measurements">Newly created Normalized Database in 3NF form with tables Location, Equipment, Measurements</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Newly created Normalized Database in 3NF form with tables Location, Equipment, Measurements</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hence-from-the-scree-plot-the-elbow-is-forming-at-12-hence-first-12-features-explain-the-95-of-the-variance-and-it-gives-the-accuracy-of-98-5-with-random-forest-classifier">Hence from the scree plot the elbow is forming at 12, hence first 12 features explain the 95% of the variance and it gives the accuracy of 98.5% with Random Forest Classifier</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-experiment">Custom Experiment</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yaseen Siddiqui
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>